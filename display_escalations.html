{% extends 'widgets/widget_template.html' %}
{% load custom_template %}

{% block custom_title_prop %}{% if title_logo %}style="background-size: auto 60%; background-position: 50%; background-repeat: no-repeat; background-image: url('/app_resource/{{ title_logo }}');"{% endif %}{% endblock %}
{% block title1 %}{{ title1 }}{% endblock %}
{% block title2 %}{{ title2 }}{% endblock %}
{% block custom_tools %}
{% endblock %}

{% block widget_content %} <!-- Main Start Block -->

<!-- File: display_escalations.html
  Copyright (c) 2016-2020 Splunk Inc.

  SPLUNK CONFIDENTIAL - Use or disclosure of this material in whole or in part
  without a valid written license from Splunk Inc. is PROHIBITED.
-->

<style>

    .pagerduty a:hover {
        text-decoration:underline;
    }
 
    .pagerduty .wf-h4-style {
        font-size : 20px;
    }
 
    .pagerduty .wf-table-vertical {
        width: initial;
        font-size: 12px;
    }
 
    .pagerduty .wf-table-vertical td{
        padding: 5px;
        border: 1px solid !important;
    }
 
    .pagerduty .wf-table-vertical tr td:first-child {
        font-weight: bold;
    }
 
    .pagerduty .dataTable th.widget-th {
        border-top: 1px solid !important;
        border-bottom: 1px solid !important;
    }
 
    .pagerduty .dataTable td {
        vertical-align: top;
    }
 
    .pagerduty .dataTable td.widget-td a{
        font-size: 12px;
    }
 
    .pagerduty .dataTable {
        font-size: 12px;
    }
 
    .pagerduty .dataTable .glyphicon.glyphicon-dot:before {
        content: "\25cf"; font-size: 10px;
    }
 
 
 </style>


<div style="overflow: auto; width: 100%; height: 100%; padding-left:10px; padding-right:10px"> <!-- Main Div -->
{% for result in results %} <!-- loop for each result -->

  <h3 class="wf-h4-style"> List Policies</h3>
  <table class="phantom-table dataTable">
    <thead>
      <th class="widget-th">Policy ID</th>
      <th class="widget-th">Policy Name</th>
      <th class="widget-th">Team ID</th>
      <th class="widget-th">User ID</th>
    </thead>
    <tbody>
      {% for policy in result.policies %}
      <tr>
        <td class="widget-td">
          <a href="javascript:;" onclick="context_menu(this, [{'contains': ['pagerduty escalation id'], 'value': '{{ policy.id }}' }],  0, {{ container.id }}, null, false);">
            {{ policy.id }}&nbsp;
            <span class="fa fa-caret-down" style="font-size: smaller;"></span>
          </a>
        </td>
        <td class="widget-td">
          {{ policy.name }}
        </td>
        {% if policy.teams %}      
        <td class="widget-td">
            {% for team in policy.teams %}
            <span class="glyphicon glyphicon-dot"></span>&nbsp;
              <a href="javascript:;" onclick="context_menu(this, [{'contains': ['pagerduty team id'], 'value': '{{ team.id }}' }],  0, {{ container.id }}, null, false);">
                {{ team.id }}
                &nbsp;
                <span class="fa fa-caret-down" style="font-size: smaller;"></span>
              </a>
              {% if not forloop.last %}<br/> {% endif %}
            {% endfor %}
        </td>
        {% else %}
        <td>None</td>
        {% endif %}

        {% if policy.escalation_rules %}      
        <td class="widget-td">
            {% for er in policy.escalation_rules %}
              {% for target in er.targets %}
              <span class="glyphicon glyphicon-dot"></span>&nbsp;
                <a href="javascript:;" onclick="context_menu(this, [{'contains': ['pagerduty user id'], 'value': '{{ target.id }}' }],  0, {{ container.id }}, null, false);">
                  {{ target.id }}
                  &nbsp;
                  <span class="fa fa-caret-down" style="font-size: smaller;"></span>
                </a>
                {% if not forloop.last %}<br/>{% endif %}
              {% endfor %}
              {% if not forloop.last %}<br/>{% endif %}
            {% endfor %}
        </td>
        {% else %}
        <td>None</td>
      {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <!------------------- For each Result END ---------------------->

{% endfor %} <!-- loop for each result end -->
</div> <!-- Main Div -->
<script>
    $.extend(true, $.fn.dataTable.defaults, {
        "searching": true,
        "bLengthChange": false,
        "language": {
          "paginate": {
            "previous": "<i class='fa fa-angle-left fa-lg'></i>",
            "next": "<i class='fa fa-angle-right fa-lg'></i>"
          },
          "emptyTable": "No data available"
        },
        "dom": '<"top">rt<"bottom"p><"clear">',
        drawCallback: function(settings) {
          var pagination = $(this).closest('.dataTables_wrapper').find('.dataTables_paginate');
          pagination.toggle(this.api().page.info().pages > 1);
        }
      });
      $('.dataTable').DataTable();
    
</script>

{% endblock %} <!-- Main Start Block -->